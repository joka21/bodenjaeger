<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend-Felder und Berechnungen - Jaeger Plugin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 8px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .meta-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .meta-info p {
            margin: 5px 0;
        }

        nav {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        nav h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        nav ul {
            list-style: none;
        }

        nav ul li {
            margin: 10px 0;
        }

        nav ul li a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav ul li a:hover {
            color: #764ba2;
        }

        section {
            background: white;
            padding: 40px;
            border-radius: 8px;
            margin-bottom: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            font-size: 1.5rem;
            margin: 30px 0 15px 0;
        }

        h4 {
            color: #555;
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }

        thead {
            background: #667eea;
            color: white;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:hover {
            background: #e9ecef;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-block .comment {
            color: #6a9955;
        }

        .code-block .keyword {
            color: #c586c0;
        }

        .code-block .string {
            color: #ce9178;
        }

        .code-block .number {
            color: #b5cea8;
        }

        .code-block .function {
            color: #dcdcaa;
        }

        .example-box {
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .example-box h4 {
            color: #667eea;
            margin-top: 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box strong {
            color: #856404;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-primary {
            background: #667eea;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #212529;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        footer {
            background: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-top: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            section {
                padding: 20px;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 8px 10px;
            }
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #667eea;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            text-decoration: none;
            font-size: 1.5rem;
        }

        .back-to-top:hover {
            background: #764ba2;
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Backend-Felder und Berechnungen</h1>
            <p>Jaeger Plugin - Dokumentation für Frontend-Entwickler</p>
            <p><strong>Stand:</strong> 2025-01-13 | <strong>Plugin Version:</strong> 1.0.1</p>
        </header>

        <nav>
            <h2>Inhaltsverzeichnis</h2>
            <ul>
                <li><a href="#produktfelder">1. Produktfelder (Meta-Keys)</a></li>
                <li><a href="#setangebot">2. Set-Angebot Felder</a></li>
                <li><a href="#preisberechnungen">3. Preisberechnungen</a></li>
                <li><a href="#zusatzprodukte">4. Zusatzprodukte-System</a></li>
                <li><a href="#ajax-endpoints">5. AJAX-Endpoints</a></li>
                <li><a href="#paketpreise">6. Paketpreise vs. m²/lfm-Preise</a></li>
                <li><a href="#frontend-integration">7. Frontend-Integration</a></li>
                <li><a href="#probleme">8. Typische Probleme und Lösungen</a></li>
                <li><a href="#debugging">9. Debugging-Tipps</a></li>
            </ul>
        </nav>

        <!-- SECTION 1: PRODUKTFELDER -->
        <section id="produktfelder">
            <h2>1. Produktfelder (Meta-Keys)</h2>

            <h3>Basis-Produktinformationen</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Beispiel</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_paketpreis</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Preis pro Paket in Euro</td>
                        <td>45.99</td>
                    </tr>
                    <tr>
                        <td><code>_paketpreis_s</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Sonderpreis pro Paket (Angebotspreis)</td>
                        <td>39.99</td>
                    </tr>
                    <tr>
                        <td><code>_paketinhalt</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Inhalt eines Pakets in m² oder lfm</td>
                        <td>2.22</td>
                    </tr>
                    <tr>
                        <td><code>_verschnitt</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Verschnitt in Prozent</td>
                        <td>5 (= 5%)</td>
                    </tr>
                    <tr>
                        <td><code>_einheit</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Einheit ausgeschrieben</td>
                        <td>Quadratmeter / Laufmeter</td>
                    </tr>
                    <tr>
                        <td><code>_einheit_short</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Einheit Abkürzung</td>
                        <td>m² / lfm</td>
                    </tr>
                    <tr>
                        <td><code>_verpackungsart</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Verpackungsart</td>
                        <td>Paket</td>
                    </tr>
                    <tr>
                        <td><code>_verpackungsart_short</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Verpackungsart Abkürzung</td>
                        <td>Pak</td>
                    </tr>
                </tbody>
            </table>

            <h3>UVP (Unverbindliche Preisempfehlung)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Beispiel</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_show_uvp</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>UVP anzeigen?</td>
                        <td>yes / no</td>
                    </tr>
                    <tr>
                        <td><code>_uvp</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>UVP in Euro pro m²/lfm</td>
                        <td>49.99</td>
                    </tr>
                    <tr>
                        <td><code>_uvp_paketpreis</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>UVP pro Paket</td>
                        <td>110.98</td>
                    </tr>
                </tbody>
            </table>

            <div class="warning-box">
                <strong>WICHTIG:</strong> Der UVP wird als Vergleichspreis verwendet, wenn <code>_show_uvp</code> = <code>yes</code> ist!
            </div>

            <h3>Lieferzeit</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Beispiel</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_show_lieferzeit</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Lieferzeit anzeigen?</td>
                        <td>yes / no</td>
                    </tr>
                    <tr>
                        <td><code>_lieferzeit</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Lieferzeit-Text</td>
                        <td>3-7 Arbeitstage oder im Markt abholen</td>
                    </tr>
                </tbody>
            </table>

            <h3>Produktbeschreibung</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_artikelbeschreibung</code></td>
                        <td><span class="badge badge-primary">text</span></td>
                        <td>Vollständige Produktbeschreibung (HTML)</td>
                    </tr>
                    <tr>
                        <td><code>_text_produktuebersicht</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Kurztext für Produktübersicht</td>
                    </tr>
                    <tr>
                        <td><code>_show_text_produktuebersicht</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Text anzeigen? (yes/no)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECTION 2: SET-ANGEBOT -->
        <section id="setangebot">
            <h2>2. Set-Angebot Felder</h2>

            <h3>Set-Angebot Konfiguration</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Beispiel</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_show_setangebot</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Set-Angebot aktiviert?</td>
                        <td>yes / no</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_titel</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Titel für Set-Angebot</td>
                        <td>Komplett-Set</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_rabatt</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Zusätzlicher Rabatt in %</td>
                        <td>5 (= 5% extra)</td>
                    </tr>
                </tbody>
            </table>

            <h3>Set-Angebot Styling</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Werte</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_setangebot_text_color</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Textfarbe</td>
                        <td>CSS-Klasse</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_text_size</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Textgröße</td>
                        <td>CSS-Klasse</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_button_style</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Button-Stil</td>
                        <td>CSS-Klasse</td>
                    </tr>
                </tbody>
            </table>

            <h3>Set-Angebot Berechnete Preise (automatisch)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                        <th>Berechnung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_setangebot_einzelpreis</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Vergleichspreis (Einzelkauf)</td>
                        <td>Siehe Preisberechnung unten</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_gesamtpreis</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Set-Preis</td>
                        <td>Siehe Preisberechnung unten</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_ersparnis_euro</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Ersparnis in Euro</td>
                        <td>Einzelpreis - Gesamtpreis</td>
                    </tr>
                    <tr>
                        <td><code>_setangebot_ersparnis_prozent</code></td>
                        <td><span class="badge badge-info">float</span></td>
                        <td>Ersparnis in Prozent</td>
                        <td>(Ersparnis / Einzelpreis) × 100</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECTION 3: PREISBERECHNUNGEN -->
        <section id="preisberechnungen">
            <h2>3. Preisberechnungen</h2>

            <h3>1. Vergleichspreis (Einzelkauf)</h3>
            <p><strong>Logik:</strong> Höchstmöglicher Preis für maximale Ersparnis-Darstellung</p>

            <div class="code-block">
<span class="comment">// Schritt 1: Hauptprodukt - UVP oder Regulärpreis</span>
<span class="keyword">if</span> (_show_uvp === <span class="string">'yes'</span> && _uvp > <span class="number">0</span>) {
    $main_comparison_price = _uvp;
} <span class="keyword">else</span> {
    $main_comparison_price = regular_price ?: price;
}

<span class="comment">// Schritt 2: Dämmung - UVP oder Regulärpreis</span>
<span class="keyword">if</span> (daemmung_show_uvp === <span class="string">'yes'</span> && daemmung_uvp > <span class="number">0</span>) {
    $daemmung_comparison_price = daemmung_uvp;
} <span class="keyword">else</span> {
    $daemmung_comparison_price = daemmung_regular_price ?: daemmung_price;
}

<span class="comment">// Schritt 3: Sockelleiste - UVP oder Regulärpreis</span>
<span class="keyword">if</span> (sockel_show_uvp === <span class="string">'yes'</span> && sockel_uvp > <span class="number">0</span>) {
    $sockel_comparison_price = sockel_uvp;
} <span class="keyword">else</span> {
    $sockel_comparison_price = sockel_regular_price ?: sockel_price;
}

<span class="comment">// Schritt 4: Gesamter Vergleichspreis</span>
$einzelpreis = $main_comparison_price + $daemmung_comparison_price + $sockel_comparison_price;
            </div>

            <div class="example-box">
                <h4>Beispiel:</h4>
                <pre>
Hauptprodukt UVP:     49,99 €/m²
Dämmung UVP:           4,99 €/m²
Sockelleiste Preis:    5,99 €/lfm
───────────────────────────────
Einzelpreis gesamt:   60,97 €
                </pre>
            </div>

            <h3>2. Set-Preis</h3>
            <p><strong>Logik:</strong> Niedrigster Preis + Aufpreise für Nicht-Standard-Produkte</p>

            <div class="code-block">
<span class="comment">// Schritt 1: Hauptprodukt Sale-Preis (niedrigster Preis)</span>
$main_set_price = sale_price ?: price;

<span class="comment">// Schritt 2: Dämmung Aufpreis (nur wenn NICHT Standard)</span>
$daemmung_surcharge = <span class="number">0</span>;
<span class="keyword">if</span> (selected_daemmung_id != standard_daemmung_id) {
    $daemmung_surcharge = <span class="function">max</span>(<span class="number">0</span>, selected_daemmung_price - standard_daemmung_price);
}

<span class="comment">// Schritt 3: Sockelleiste Aufpreis (nur wenn NICHT Standard)</span>
$sockelleisten_surcharge = <span class="number">0</span>;
<span class="keyword">if</span> (selected_sockelleisten_id != standard_sockelleisten_id) {
    $sockelleisten_surcharge = <span class="function">max</span>(<span class="number">0</span>, selected_sockelleisten_price - standard_sockelleisten_price);
}

<span class="comment">// Schritt 4: Zusätzlicher Set-Rabatt</span>
<span class="keyword">if</span> (_setangebot_rabatt > <span class="number">0</span>) {
    $rabatt_faktor = <span class="number">1</span> - (_setangebot_rabatt / <span class="number">100</span>);
} <span class="keyword">else</span> {
    $rabatt_faktor = <span class="number">1</span>;
}

<span class="comment">// Schritt 5: Finaler Set-Preis</span>
$set_price = ($main_set_price + $daemmung_surcharge + $sockelleisten_surcharge) * $rabatt_faktor;
            </div>

            <div class="example-box">
                <h4>Beispiel:</h4>
                <pre>
Hauptprodukt Sale:    39,99 €/m²
Dämmung (Standard):   +0,00 €/m² (kostenlos)
Sockelleiste (Premium): +2,00 €/lfm (Aufpreis)
Zusatzrabatt:         -5%
───────────────────────────────
Set-Preis:            39,89 €
                </pre>
            </div>

            <h3>3. Ersparnis</h3>

            <div class="code-block">
$ersparnis_euro = $einzelpreis - $set_price;
$ersparnis_prozent = ($ersparnis_euro / $einzelpreis) * <span class="number">100</span>;
            </div>

            <div class="example-box">
                <h4>Beispiel:</h4>
                <pre>
Einzelpreis:          60,97 €
Set-Preis:            39,89 €
───────────────────────────────
Ersparnis:            21,08 € (34,6%)
                </pre>
            </div>
        </section>

        <!-- SECTION 4: ZUSATZPRODUKTE -->
        <section id="zusatzprodukte">
            <h2>4. Zusatzprodukte-System</h2>

            <h3>Standard-Zusatzprodukte</h3>
            <p>Diese Produkte sind kostenlos im Set enthalten:</p>

            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_standard_addition_daemmung</code></td>
                        <td><span class="badge badge-info">int</span></td>
                        <td>Produkt-ID der Standard-Dämmung</td>
                    </tr>
                    <tr>
                        <td><code>_standard_addition_sockelleisten</code></td>
                        <td><span class="badge badge-info">int</span></td>
                        <td>Produkt-ID der Standard-Sockelleiste</td>
                    </tr>
                </tbody>
            </table>

            <h3>Optionale Zusatzprodukte</h3>
            <p>Auswählbare Alternativprodukte (mit möglichem Aufpreis):</p>

            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_option_products_daemmung</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Kommagetrennte Produkt-IDs für Dämmung-Optionen</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_sockelleisten</code></td>
                        <td><span class="badge badge-primary">string</span></td>
                        <td>Kommagetrennte Produkt-IDs für Sockelleisten-Optionen</td>
                    </tr>
                </tbody>
            </table>

            <div class="example-box">
                <h4>Beispiel:</h4>
                <div class="code-block">
_option_products_daemmung = <span class="string">"123,456,789"</span>
_option_products_sockelleisten = <span class="string">"234,567,890"</span>
                </div>
            </div>

            <h3>Zubehör-Kategorien</h3>
            <p>Zusätzliche Zubehör-Optionen:</p>

            <table>
                <thead>
                    <tr>
                        <th>Meta-Key</th>
                        <th>Kategorie</th>
                        <th>Beispiele</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>_option_products_untergrundvorbereitung</code></td>
                        <td>Untergrundvorbereitung</td>
                        <td>Grundierung, Spachtelmasse</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_werkzeug</code></td>
                        <td>Werkzeug</td>
                        <td>Cutter, Zollstock</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_kleber</code></td>
                        <td>Kleber</td>
                        <td>Bodenkleber</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_montagekleber-silikon</code></td>
                        <td>Montagekleber/Silikon</td>
                        <td>Montagekleber</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_zubehoer-fuer-sockelleisten</code></td>
                        <td>Sockelleisten-Zubehör</td>
                        <td>Clips, Endkappen</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_schienen-profile</code></td>
                        <td>Schienen/Profile</td>
                        <td>Übergangsprofil</td>
                    </tr>
                    <tr>
                        <td><code>_option_products_reinigung-pflege</code></td>
                        <td>Reinigung/Pflege</td>
                        <td>Bodenreiniger</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECTION 5: PAKETPREISE -->
        <section id="paketpreise">
            <h2>6. Paketpreise vs. m²/lfm-Preise</h2>

            <div class="warning-box">
                <strong>WICHTIG: Zwei verschiedene Preissysteme!</strong>
            </div>

            <h3>1. WooCommerce Standard-Preise (m²/lfm)</h3>
            <p>Diese werden in WooCommerce-Produkten gespeichert:</p>

            <ul style="margin: 20px 0; padding-left: 40px;">
                <li><code>$product->get_price()</code> → Aktueller Preis pro m² oder lfm</li>
                <li><code>$product->get_regular_price()</code> → Regulärer Preis pro m² oder lfm</li>
                <li><code>$product->get_sale_price()</code> → Angebotspreis pro m² oder lfm</li>
            </ul>

            <div class="info-box">
                <strong>Verwendung:</strong> Produktanzeige, Preisvergleich, Aufpreis-Berechnung
            </div>

            <h3>2. Paketpreise (Custom Fields)</h3>
            <p>Diese werden in Post-Meta gespeichert:</p>

            <ul style="margin: 20px 0; padding-left: 40px;">
                <li><code>_paketpreis</code> → Preis für ein gesamtes Paket</li>
                <li><code>_paketpreis_s</code> → Sonderpreis für ein gesamtes Paket</li>
                <li><code>_paketinhalt</code> → Inhalt des Pakets in m²/lfm</li>
            </ul>

            <div class="info-box">
                <strong>Verwendung:</strong> Warenkorb, Gesamtsumme
            </div>

            <h3>Umrechnung</h3>

            <div class="code-block">
<span class="comment">// m²/lfm → Paketpreis</span>
$paketpreis = $preis_pro_einheit * $paketinhalt;

<span class="comment">// Paketpreis → m²/lfm</span>
$preis_pro_einheit = $paketpreis / $paketinhalt;
            </div>

            <div class="example-box">
                <h4>Beispiel:</h4>
                <pre>
Produkt: Laminat
─────────────────────────────────────
WooCommerce-Preis:     18,00 €/m²
Paketinhalt:           2,22 m²
Paketpreis:            39,96 €
                </pre>
            </div>
        </section>

        <!-- SECTION 6: AJAX ENDPOINTS -->
        <section id="ajax-endpoints">
            <h2>5. AJAX-Endpoints</h2>

            <h3>1. Produktoptionen abrufen</h3>
            <p><strong>Action:</strong> <code>jaeger_get_product_options</code></p>

            <h4>Request:</h4>
            <div class="code-block">
{
    action: <span class="string">'jaeger_get_product_options'</span>,
    product_id: <span class="number">123</span>,              <span class="comment">// Hauptprodukt-ID</span>
    category: <span class="string">'daemmung'</span>,         <span class="comment">// 'daemmung' oder 'sockelleisten'</span>
    nonce: <span class="string">'wp_nonce_value'</span>
}
            </div>

            <h4>Response:</h4>
            <div class="code-block">
{
    success: <span class="keyword">true</span>,
    data: {
        products: [
            {
                id: <span class="number">456</span>,
                name: <span class="string">"Dämmung Basic PE-Schaum 2mm"</span>,
                price: <span class="number">0.95</span>,                        <span class="comment">// m²/lfm-Preis</span>
                formatted_price: <span class="string">"0,95 €"</span>,
                image: [...],
                is_standard: <span class="keyword">true</span>,
                surcharge: <span class="number">0</span>,                       <span class="comment">// Aufpreis in €/m² oder €/lfm</span>
                formatted_surcharge: <span class="keyword">null</span>,
                is_free_in_set: <span class="keyword">true</span>
            },
            {
                id: <span class="number">457</span>,
                name: <span class="string">"Dämmung Premium XPS 3mm"</span>,
                price: <span class="number">2.95</span>,                        <span class="comment">// m²/lfm-Preis</span>
                formatted_price: <span class="string">"2,95 €"</span>,
                image: [...],
                is_standard: <span class="keyword">false</span>,
                surcharge: <span class="number">2.00</span>,                    <span class="comment">// Aufpreis: 2,95 - 0,95</span>
                formatted_surcharge: <span class="string">"2,00 €"</span>,
                is_free_in_set: <span class="keyword">false</span>
            }
        ],
        category: <span class="string">'daemmung'</span>
    }
}
            </div>

            <h3>2. Produkt wechseln</h3>
            <p><strong>Action:</strong> <code>jaeger_change_setangebot_product</code></p>

            <h4>Request:</h4>
            <div class="code-block">
{
    action: <span class="string">'jaeger_change_setangebot_product'</span>,
    product_id: <span class="number">123</span>,                    <span class="comment">// Hauptprodukt-ID</span>
    category: <span class="string">'daemmung'</span>,               <span class="comment">// 'daemmung' oder 'sockelleisten'</span>
    selected_product_id: <span class="number">457</span>,           <span class="comment">// Gewähltes Zusatzprodukt</span>
    current_daemmung: <span class="number">456</span>,              <span class="comment">// Aktuell gewählte Dämmung</span>
    current_sockelleisten: <span class="number">789</span>,         <span class="comment">// Aktuell gewählte Sockelleiste</span>
    packages: <span class="number">5</span>,                        <span class="comment">// Anzahl Pakete</span>
    sqm: <span class="number">11.1</span>,                          <span class="comment">// Quadratmeter</span>
    nonce: <span class="string">'wp_nonce_value'</span>
}
            </div>

            <h4>Response:</h4>
            <div class="code-block">
{
    success: <span class="keyword">true</span>,
    data: {
        id: <span class="number">457</span>,
        name: <span class="string">"Dämmung Premium XPS 3mm"</span>,
        price: <span class="number">2.95</span>,                    <span class="comment">// m²/lfm-Preis</span>
        image_url: <span class="string">"https://..."</span>,
        is_standard: <span class="keyword">false</span>,
        is_free: <span class="keyword">false</span>,
        surcharge: <span class="number">2.00</span>,                <span class="comment">// Aufpreis in €/m² oder €/lfm</span>
        formatted_price: <span class="string">"2,95 €"</span>,
        formatted_surcharge: <span class="string">"2,00 €"</span>,
        clean_surcharge: <span class="number">2.00</span>,          <span class="comment">// Saubere Zahl für JS</span>

        <span class="comment">// Preisvergleich für oberen Bereich</span>
        price_comparison: {
            einzelkauf_total: <span class="number">60.97</span>,
            set_preis: <span class="number">41.99</span>,
            ersparnis_euro: <span class="number">18.98</span>,
            ersparnis_prozent: <span class="number">31.13</span>,
            formatted_einzelkauf_total: <span class="string">"60,97 €"</span>,
            formatted_set_preis: <span class="string">"41,99 €"</span>,
            formatted_ersparnis_euro: <span class="string">"18,98 €"</span>
        },

        <span class="comment">// Gesamtsumme für unteren Bereich</span>
        order_summary: {
            gesamtpreis_pro_paket: <span class="number">44.40</span>,          <span class="comment">// Paketpreis inkl. ALLER Aufpreise</span>
            formatted_gesamtpreis_pro_paket: <span class="string">"44,40 €"</span>
        }
    }
}
            </div>

            <div class="warning-box">
                <strong>WICHTIG:</strong><br>
                - <code>surcharge</code> und <code>clean_surcharge</code> sind <strong>m²/lfm-Preise</strong> (für Produktanzeige)<br>
                - <code>order_summary.gesamtpreis_pro_paket</code> ist der <strong>Paketpreis</strong> (für Gesamtsumme)
            </div>

            <h3>3. Set zum Warenkorb hinzufügen</h3>
            <p><strong>Action:</strong> <code>jaeger_add_set_to_cart</code></p>

            <h4>Request:</h4>
            <div class="code-block">
{
    action: <span class="string">'jaeger_add_set_to_cart'</span>,
    product_id: <span class="number">123</span>,                    <span class="comment">// Hauptprodukt-ID</span>
    packages: <span class="number">5</span>,                        <span class="comment">// Anzahl Pakete</span>
    sqm: <span class="number">11.1</span>,                          <span class="comment">// Quadratmeter</span>
    selected_daemmung: <span class="number">457</span>,             <span class="comment">// Gewählte Dämmung</span>
    selected_sockelleisten: <span class="number">789</span>,        <span class="comment">// Gewählte Sockelleiste</span>
    nonce: <span class="string">'wp_nonce_value'</span>
}
            </div>

            <h4>Response:</h4>
            <div class="code-block">
{
    success: <span class="keyword">true</span>,
    data: {
        message: <span class="string">"Set erfolgreich zum Warenkorb hinzugefügt."</span>,
        cart_item_key: <span class="string">"abc123"</span>,
        redirect_url: <span class="string">"https://.../warenkorb/"</span>
    }
}
            </div>
        </section>

        <!-- SECTION 7: FRONTEND INTEGRATION -->
        <section id="frontend-integration">
            <h2>7. Frontend-Integration Beispiele</h2>

            <h3>1. Initiale Produktdaten laden</h3>
            <div class="code-block">
<span class="comment">// Diese Daten werden vom PHP-Template als JavaScript-Variable übergeben</span>
<span class="keyword">const</span> JaegerSetAngebot = {
    ajax_url: <span class="string">'/wp-admin/admin-ajax.php'</span>,
    nonce: <span class="string">'wp_nonce_value'</span>,
    product_id: <span class="number">123</span>,
    paketinhalt: <span class="number">2.22</span>,
    verschnitt: <span class="number">5</span>,
    basePrice: <span class="number">39.99</span>,              <span class="comment">// Sale-Preis des Hauptprodukts (m²)</span>
    paketpreis: <span class="number">88.76</span>,             <span class="comment">// Paketpreis regulär</span>
    paketpreis_s: <span class="number">79.99</span>,           <span class="comment">// Paketpreis Sonderangebot</span>
    currency_symbol: <span class="string">'€'</span>
};
            </div>

            <h3>2. Preisanzeige in Produktkarte</h3>
            <div class="code-block">
<span class="comment">&lt;!-- Dämmung Card --&gt;</span>
&lt;div class=<span class="string">"product-card daemmung-card"</span> data-category=<span class="string">"daemmung"</span> data-product-id=<span class="string">"456"</span>&gt;
    &lt;div class=<span class="string">"product-info"</span>&gt;
        &lt;div class=<span class="string">"product-name"</span>&gt;Dämmung Basic PE-Schaum 2mm&lt;/div&gt;
        &lt;div class=<span class="string">"product-prices"</span>&gt;
            <span class="comment">&lt;!-- Durchgestrichener Preis (UVP oder Regular) --&gt;</span>
            &lt;div class=<span class="string">"original-price"</span>&gt;0,95 €/m²&lt;/div&gt;
            <span class="comment">&lt;!-- Roter Preis (kostenlos oder Aufpreis) --&gt;</span>
            &lt;div class=<span class="string">"free-price"</span>&gt;0,00 €/m²&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

<span class="comment">&lt;!-- Bei Nicht-Standard mit Aufpreis --&gt;</span>
&lt;div class=<span class="string">"product-card daemmung-card"</span> data-category=<span class="string">"daemmung"</span> data-product-id=<span class="string">"457"</span>&gt;
    &lt;div class=<span class="string">"product-info"</span>&gt;
        &lt;div class=<span class="string">"product-name"</span>&gt;Dämmung Premium XPS 3mm&lt;/div&gt;
        &lt;div class=<span class="string">"product-prices"</span>&gt;
            &lt;div class=<span class="string">"original-price"</span>&gt;2,95 €/m²&lt;/div&gt;
            <span class="comment">&lt;!-- Aufpreis anzeigen --&gt;</span>
            &lt;div class=<span class="string">"free-price"</span>&gt;+2,00 €/m²&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
            </div>

            <h3>3. Preisvergleich aktualisieren (nach Produktwechsel)</h3>
            <div class="code-block">
<span class="comment">// Nach AJAX-Response</span>
<span class="keyword">if</span> (response.data.price_comparison) {
    <span class="keyword">const</span> pc = response.data.price_comparison;

    <span class="comment">// Oberer Bereich: Preisvergleich</span>
    $(<span class="string">'.individual-total'</span>).html(pc.formatted_einzelkauf_total);
    $(<span class="string">'.set-total'</span>).html(pc.formatted_set_preis + <span class="string">'/m²'</span>);
    $(<span class="string">'.savings-badge'</span>).text(<span class="string">'-'</span> + Math.<span class="function">round</span>(pc.ersparnis_prozent) + <span class="string">'%'</span>);
}
            </div>

            <h3>4. Gesamtsumme aktualisieren</h3>
            <div class="code-block">
<span class="comment">// Nach AJAX-Response</span>
<span class="keyword">if</span> (response.data.order_summary) {
    <span class="keyword">const</span> os = response.data.order_summary;
    <span class="keyword">const</span> packages = <span class="function">parseInt</span>($(<span class="string">'#packages-input'</span>).val()) || <span class="number">1</span>;

    <span class="comment">// WICHTIG: Verwende Paketpreis vom Backend</span>
    <span class="keyword">const</span> totalPrice = os.gesamtpreis_pro_paket * packages;

    <span class="comment">// Unterer Bereich: Gesamtsumme</span>
    $(<span class="string">'#total-amount'</span>).html(<span class="function">formatPrice</span>(totalPrice));
}
            </div>

            <h3>5. Produktkarte nach Wechsel aktualisieren</h3>
            <div class="code-block">
<span class="keyword">function</span> <span class="function">updateProductCard</span>(category, productData) {
    <span class="comment">// Normalisiere Kategorie (sockelleisten → sockelleiste)</span>
    <span class="keyword">const</span> normalizedCategory = (category === <span class="string">'sockelleisten'</span>) ? <span class="string">'sockelleiste'</span> : category;

    <span class="comment">// Finde Card</span>
    <span class="keyword">const</span> $card = $(<span class="string">`.product-card[data-category="${normalizedCategory}"]`</span>);

    <span class="comment">// Bild aktualisieren</span>
    $card.find(<span class="string">'.product-image'</span>).attr(<span class="string">'src'</span>, productData.image_url);

    <span class="comment">// Name aktualisieren</span>
    $card.find(<span class="string">'.product-name'</span>).text(productData.name);

    <span class="comment">// Original-Preis aktualisieren</span>
    <span class="keyword">const</span> unit = (category === <span class="string">'daemmung'</span>) ? <span class="string">'/m²'</span> : <span class="string">'/lfm'</span>;
    $card.find(<span class="string">'.original-price'</span>).html(productData.formatted_price + unit);

    <span class="comment">// Free-Preis aktualisieren</span>
    <span class="keyword">if</span> (productData.is_free || productData.clean_surcharge <= <span class="number">0</span>) {
        $card.find(<span class="string">'.free-price'</span>).text(<span class="string">'0,00 €'</span> + unit);
    } <span class="keyword">else</span> {
        <span class="keyword">const</span> formattedSurcharge = <span class="function">formatPrice</span>(productData.clean_surcharge);
        $card.find(<span class="string">'.free-price'</span>).text(<span class="string">'+'</span> + formattedSurcharge + unit);
    }

    <span class="comment">// data-product-id aktualisieren</span>
    $card.attr(<span class="string">'data-product-id'</span>, productData.id);
}
            </div>
        </section>

        <!-- SECTION 8: PROBLEME -->
        <section id="probleme">
            <h2>8. Typische Probleme und Lösungen</h2>

            <h3>Problem 1: Kategorie-Inkonsistenz</h3>
            <div class="warning-box">
                <strong>Symptom:</strong> Cards werden nicht gefunden<br>
                <strong>Ursache:</strong> PHP verwendet <code>sockelleiste</code> (singular), JS verwendet <code>sockelleisten</code> (plural)
            </div>
            <div class="success-box">
                <strong>Lösung:</strong> Immer normalisieren:
                <div class="code-block">
<span class="keyword">const</span> normalizedCategory = (category === <span class="string">'sockelleisten'</span>) ? <span class="string">'sockelleiste'</span> : category;
                </div>
            </div>

            <h3>Problem 2: Falsche Preise nach Produktwechsel</h3>
            <div class="warning-box">
                <strong>Symptom:</strong> Gesamtsumme stimmt nicht nach Produktwechsel<br>
                <strong>Ursache:</strong> m²/lfm-Preise statt Paketpreise verwendet
            </div>
            <div class="success-box">
                <strong>Lösung:</strong> Immer <code>order_summary.gesamtpreis_pro_paket</code> vom Backend verwenden
                <div class="code-block">
<span class="comment">// FALSCH</span>
<span class="keyword">const</span> totalPrice = response.data.price * packages;

<span class="comment">// RICHTIG</span>
<span class="keyword">const</span> totalPrice = response.data.order_summary.gesamtpreis_pro_paket * packages;
                </div>
            </div>

            <h3>Problem 3: UVP wird nicht berücksichtigt</h3>
            <div class="warning-box">
                <strong>Symptom:</strong> Ersparnis zu niedrig<br>
                <strong>Ursache:</strong> Backend-Preisberechnung verwendet UVP, aber Frontend nicht
            </div>
            <div class="success-box">
                <strong>Lösung:</strong> Backend-Daten aus <code>price_comparison</code> verwenden
                <div class="code-block">
<span class="comment">// FALSCH - Frontend berechnet selbst</span>
<span class="keyword">const</span> savings = oldPrice - newPrice;

<span class="comment">// RICHTIG - Backend-Daten verwenden</span>
<span class="keyword">const</span> savings = response.data.price_comparison.ersparnis_euro;
                </div>
            </div>
        </section>

        <!-- SECTION 9: DEBUGGING -->
        <section id="debugging">
            <h2>9. Debugging-Tipps</h2>

            <h3>Backend-Logs prüfen</h3>
            <div class="code-block">
<span class="comment"># WordPress Debug-Log</span>
tail -f wp-content/debug.log | grep <span class="string">"Jaeger"</span>

<span class="comment"># Plugin Debug-Log</span>
tail -f wp-content/debug-jaeger-plugin.log
            </div>

            <h3>Frontend-Konsole</h3>
            <div class="code-block">
<span class="comment">// Debug-Modus aktivieren</span>
JaegerSetAngebot.debug = <span class="keyword">true</span>;

<span class="comment">// Dann werden diese Variablen verfügbar:</span>
window.SetAngebotManager  <span class="comment">// Manager-Instanz</span>
window.setData            <span class="comment">// Aktuelle Set-Daten</span>
            </div>

            <h3>AJAX-Requests monitoren</h3>
            <p>Browser DevTools → Network Tab → Filter: <code>admin-ajax.php</code></p>

            <div class="info-box">
                <strong>Wichtige Felder in Response prüfen:</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li><code>response.data.price_comparison</code> → Preisvergleich-Daten</li>
                    <li><code>response.data.order_summary</code> → Gesamtsummen-Daten</li>
                    <li><code>response.data.clean_surcharge</code> → Sauberer Aufpreis (Zahl, nicht formatiert)</li>
                </ul>
            </div>
        </section>

        <footer>
            <h3>Kontakt & Support</h3>
            <p><strong>Backend-Entwickler:</strong> Jo Kalenberg</p>
            <p><strong>Plugin-Dokumentation:</strong> <code>CLAUDE.md</code> im Plugin-Root</p>
            <p><strong>Technische Fragen:</strong> Siehe Error-Logs oder AJAX-Response-Debug-Ausgaben</p>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
            <p><strong>Letzte Aktualisierung:</strong> 2025-01-13</p>
            <p><strong>Dokumentiert von:</strong> Claude (AI-Assistant)</p>
        </footer>
    </div>

    <a href="#" class="back-to-top" title="Nach oben">↑</a>

    <script>
        // Smooth Scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Back to Top Button
        const backToTop = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTop.style.display = 'flex';
            } else {
                backToTop.style.display = 'none';
            }
        });

        backToTop.addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>